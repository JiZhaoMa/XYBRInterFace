<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>

</head>
<body id="body">
    <div id="title">
        <div style="width:97.6vw;">
            <span>星源博锐供应链看板</span>
            <span style="font-size: 18px !important; font-weight: bold;">—— 月度生产计划及发货</span>
        </div>
        <div style="position: fixed; left: 84%; top: 3%">
            <select name="selectMonth" id="selectMonth" style="background-color: rgb(21,51,114); color: #FFFFFF; border: 0.2px solid #FFF; border-radius: 3px 3px 3px 3px;">
                <option value="01">一月</option>
                <option value="02">二月</option>
                <option value="03">三月</option>
                <option value="04">四月</option>
                <option value="05">五月</option>
                <option value="06">六月</option>
                <option value="07">七月</option>
                <option value="08">八月</option>
                <option value="09">九月</option>
                <option value="10">十月</option>
                <option value="11">十一月</option>
                <option value="12">十二月</option>
            </select>
            <select name="selectAgent" id="selectAgent" style="background-color: rgb(21,51,114); color: #FFFFFF; border: 0.2px solid #FFF; border-radius: 3px 3px 3px 3px;">
                <option value="">所有</option>
                <option value="天宝">天宝</option>
                <option value="卓瑞源">卓瑞源</option>
            </select>
        </div>
    </div>
    <div id="lineChart">
        <div id="planSum">
            <span>总计划</span>
        </div>
        <div id="month">
            <div style="width: 20%; display: inline-block;">
                <span id="monthOfFirst"></span>
            </div>
            <div style="width: 20%; display: inline-block;">
                <span id="monthOfSecond"></span>
            </div>
            <div style="width: 20%; display: inline-block;">
                <span id="monthOfThird"></span>
            </div>
        </div>
        <div id="productPlan">
            <span>生产计划</span>
            <div style="position: relative;left: 25%;top: -24px;">
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfFirstPlan"></span>
                </div>
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfSecondPlan"></span>
                </div>
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfThirdPlan"></span>
                </div>
            </div>
        </div>
        <div id="complateRate">
            <div>
                <span>计划完成率</span>
            </div>
            <div style="position: relative;left: 25%;top: -24px;">
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfFirstFinsh"></span>
                </div>
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfSecondFinsh"></span>
                </div>
                <div style="width: 20%; display: inline-block;">
                    <span id="monthOfThirdFinsh"></span>
                </div>
            </div>
        </div>
    </div>
    <div id="productOfMonth">
        <div id="planOfMonth">
            <span>月生产计划</span>
        </div>
        <div style="height: 94%">
            <iframe src="" width="100%" height="100%" id="productOfMonthIframe" style="border: none">
                您的浏览器不支持iframe，请升级
            </iframe>
        </div>
    </div>
    <div id="productOfMonthSum">
        <div style="position: fixed; display: flex; top: 40%">
            <div style="width:12.2vw; color: #FFFFFF; font-size: 18px; font-weight: bold">
                <span>合计</span>
            </div>
            <div style="width:12.2vw; color: #FFFFFF; font-size: 18px; font-weight: bold">
                <span id="currentMonthPlan">50000</span>
            </div>
            <div style="width:12.2vw; color: #FFFFFF; font-size: 18px; font-weight: bold">
                <span id="currentMonthFinish">4900</span>
            </div>
            <div style="width:12.2vw; color: #FFFFFF; font-size: 18px; font-weight: bold">
                <span id="currentMonthFinishRate">98.88%</span>
            </div>
        </div>
    </div>
    <div id="faHuoDiv">
        <div id="faHuo">
            <span>当年累计发货</span>
        </div>
        <div id="faHuoPie">

        </div>
    </div>
    <div id="faHuoNumDiv">
        <div id="faHuoNum">
            <span>月滚动发货量</span>
        </div>
        <div id="faHuoNumPie">

        </div>
    </div>
<style>
    #planSum {
        height: 20%;
        color: #FFFFFF;
        font-size: 20px;
        font-weight: bold;
        top: -6%;
        left: 5%;
        position: relative;
        width: 20%;
        background-color: rgb(21, 51, 114);
        text-align: center;
    }
    #planOfMonth {
        height: 6%;
        color: #FFFFFF;
        font-size: 20px;
        font-weight: bold;
        top: -6%;
        left: 5%;
        position: relative;
        width: 20%;
        background-color: rgb(21, 51, 114);
        text-align: center;
    }
    #faHuo {
        height: 4%;
        color: #FFFFFF;
        font-size: 20px;
        font-weight: bold;
        top: -4%;
        left: 5%;
        position: relative;
        width: 30%;
        background-color: rgb(21, 51, 114);
        text-align: center;
    }
    #faHuoNum {
        height: 4%;
        color: #FFFFFF;
        font-size: 20px;
        font-weight: bold;
        top: -4%;
        left: 5%;
        position: relative;
        width: 30%;
        background-color: rgb(21, 51, 114);
        text-align: center;
    }
    #month {
        height: 15%;
        top: 0%;
        left: 35%;
        position: relative;
        color: #FFFFFF;
        font-size: 18px;
        font-weight: bold;
    }
    #productPlan {
        height: 20%;
        top: 8%;
        left: 10%;
        position: relative;
        color: #FFFFFF;
        font-size: 18px;
        font-weight: bold;
    }
    #complateRate {
        height: 20%;
        top: 13%;
        left: 10%;
        position: relative;
        color: #FFFFFF;
        font-size: 18px;
        font-weight: bold;
    }

    #body {
        height: 620px;
        background-color: rgb(21,51,114) !important;
        content: none;
    }
    #title {
        height: 8%;
        color: #FFFFFF;
        width: 40%;
        margin-left: auto;
        margin-right: auto;
        font-size: 25px;
        display: flex;
        font-family: '思源-heavy';
        background-image: url("http://localhost:80/img/liuhai.jpg");
        background-position: bottom;
        text-align: center;
    }
    #lineChart {
        width: 35%;
        height: 30%;
        position: relative;
        left: 3%;
        top: 2%;
        background-color: rgb(21,51,114) !important;
        float: left;
        border: 0.2px solid #FFF;
    }
    #productOfMonth {
        width: 50%;
        height: 28%;
        position: relative;
        left: 9%;
        top: 2%;
        background-color: rgb(21,51,114) !important;
        float: left;
        border: 0.2px solid #FFF;
    }
    #productOfMonthSum {
        width: 50%;
        height: 8%;
        position: relative;
        left: 10%;
        float: left;
    }
    #faHuoDiv {
        width: 40%;
        height: 45%;
        position: relative;
        left: 3%;
        top: 8%;
        background-color: rgb(21,51,114) !important;
        float: left;
        border: 0.2px solid #FFF;
    }
    #faHuoPie {
        width: 100%;
        height: 100%;
        left:-5%;
        position: relative;
    }
    #faHuoNumDiv {
        width: 45%;
        height: 45%;
        position: relative;
        left: 9%;
        top: 8%;
        background-color: rgb(21,51,114) !important;
        float: left;
        border: 0.2px solid #FFF;
    }
    #faHuoNumPie {
        width: 100%;
        height: 100%;
        position: relative;
    }
</style>

<script type="text/javascript" th:src="@{/js/plugins/echarts.min.js}"></script>
<script type="text/javascript" th:src="@{/js/xybr/report.js}"></script>
<script type="text/javascript" th:src="@{/js/xybr/productPlan.js}"></script>
<script type="text/javascript" th:src="@{/js/xybr/productPlanOfMonth.js}"></script>
<script type="text/javascript" th:src="@{/js/xybr/faHuo.js}"></script>
<script type="text/javascript" th:src="@{/js/xybr/faHuoNum.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript">
    var urls = "http://192.168.31.52:8084/xybrInterFace/";
    //var urls = "http://localhost/";
    let faHuoPie = echarts.init(document.getElementById("faHuoPie"));
    let faHuoNumPie = echarts.init(document.getElementById("faHuoNumPie"));
    window.onload = function (){
        var width = window.innerWidth;
        var height = window.innerHeight;
        var body = document.getElementById("body");
        body.style.height = height - 20 + 'px';

        //给下拉框初始值
       var currentDays = new Date();
       var year = currentDays.getFullYear();
       var month = currentDays.getMonth();
       if(month < 10){
           month = '0' + month;
       }
       //总计划
       getPlanSum(month,"");
       //月生产计划
       document.getElementById("selectMonth").value = month;
       document.getElementById("productOfMonthIframe").src = urls + "report/plan/getProductPlanOfMonth/"+month+"/"+0;
       //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+month+"/"+0;
       //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+month+"/"+0;
       //初始化
       let faHuoPie = echarts.init(document.getElementById("faHuoPie"));
       let faHuoNumPie = echarts.init(document.getElementById("faHuoNumPie"));
       //当年累计发货
       createFaHuoPie(faHuoPie,document.getElementById("selectAgent").value, urls);
       //月滚动发货量
       createfaHuoNum(faHuoNumPie, document.getElementById("selectMonth").value, document.getElementById("selectAgent").value, urls);
    };
   $(document).ready(function (){
       $("#selectMonth").change(function (){
           var monthValue = $(this).val();
           var agentValue = document.getElementById("selectAgent").value;
           if(agentValue == ""){
               agentValue = "0";
           }
           document.getElementById("productOfMonthIframe").src = urls + "report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
           getPlanSum(monthValue,agentValue);
           createfaHuoNum(faHuoNumPie, document.getElementById("selectMonth").value, document.getElementById("selectAgent").value, urls);
           //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
           //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
       });
       $("#selectAgent").change(function (){
           var monthValue = document.getElementById("selectMonth").value;
           var agentValue = $(this).val();
           if(agentValue == ""){
               agentValue = "0";
           }
           document.getElementById("productOfMonthIframe").src = urls + "report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
           getPlanSum(monthValue,agentValue);
           createFaHuoPie(faHuoPie,document.getElementById("selectAgent").value, urls);
           createfaHuoNum(faHuoNumPie, document.getElementById("selectMonth").value, document.getElementById("selectAgent").value, urls);
           //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
           //document.getElementById("productOfMonthIframe").src = "http://192.168.31.52:8084/xybrInterFace/report/plan/getProductPlanOfMonth/"+monthValue+"/"+agentValue;
       });
   })

    function getPlanSum(monthValue,agentValue) {
        $.ajax({
            type: "GET",
            url: urls + "report/plan/getPlanSumData",
            contentType: "application/json;charset=utf-8",
            data: {
                "monthStr": monthValue,
                "agent": agentValue
            },
            dateType: "json",
            success: function (data) {
                document.getElementById('monthOfFirst').innerText = data.mmap.monthOfFirst;
                document.getElementById('monthOfSecond').innerText = data.mmap.monthOfSecond;
                document.getElementById('monthOfThird').innerText = data.mmap.monthOfThird;
                document.getElementById('monthOfFirstPlan').innerText = data.mmap.monthOfFirstPlan == null ? 0 : data.mmap.monthOfFirstPlan;
                document.getElementById('monthOfSecondPlan').innerText = data.mmap.monthOfSecondPlan == null ? 0 : data.mmap.monthOfSecondPlan;
                document.getElementById('monthOfThirdPlan').innerText = data.mmap.monthOfThirdPlan == null ? 0 : data.mmap.monthOfThirdPlan;
                document.getElementById('monthOfFirstFinsh').innerText = data.mmap.monthOfFirstFinsh == null ? "0.00%" : (data.mmap.monthOfFirstFinsh * 100).toFixed(2) + "%";
                document.getElementById('monthOfSecondFinsh').innerText = data.mmap.monthOfSecondFinsh == null ? "0.00%" : (data.mmap.monthOfSecondFinsh * 100).toFixed(2) + "%";
                document.getElementById('monthOfThirdFinsh').innerText = data.mmap.monthOfThirdFinsh == null ? "0.00%" : (data.mmap.monthOfThirdFinsh * 100).toFixed(2) + "%";

                document.getElementById('currentMonthPlan').innerText = data.mmap.monthOfFourPlan == null ? "0" : data.mmap.monthOfFourPlan;
                document.getElementById('currentMonthFinish').innerText = data.mmap.monthOfFourFinsh == null ? "0" : data.mmap.monthOfFourFinsh;
                document.getElementById('currentMonthFinishRate').innerText = (data.mmap.monthOfFourPlan == null || data.mmap.monthOfFourPlan == 0)? "0" : ((data.mmap.monthOfFourFinsh/data.mmap.monthOfFourPlan)*100).toFixed(2) + "%";
            },
            error: function (data) {
                alert("失败");
            }

        });
    }
</script>
</body>
</html>
